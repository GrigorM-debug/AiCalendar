@page "/users/logout"
@attribute [Authorize]
@using AiCalendar.Blazor.Services
@using AiCalendar.Blazor.Services.UserSession
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation
@inject IUserSessionManager Auth
@rendermode InteractiveServer

@code {
    [CascadingParameter] protected Task<AuthenticationState> AuthState { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var user = (await AuthState).User;
        if (!user.Identity.IsAuthenticated)
        {
            Navigation.NavigateTo("/users/login", forceLoad: true);
            return;
        }

        await ((CustomAuthenticationStateProvider)AuthenticationStateProvider).MarkUserAsLoggedOut();
        //Auth.SignOutUser();

        Navigation.NavigateTo("/", forceLoad: true);
    }
}
